@page "/"
@inject IJSRuntime JsRuntime

<PageTitle>Index</PageTitle>

<body>
	<script>
		window.triggerClick = (elt) => elt.click();
	</script>
	<script suppress-error="BL9992" type="module" src="build/build.js"></script>

	<RazorLED value="@value"></RazorLED>
<button @ref="refresh" hidden="hidden" @onclick="StateChanged">refresh</button>

<div class="page">
    <div class="sidebar" style="width: @leftSidebarWidth">
        <!-- Left Sidebar Content -->
    </div>
	<div class="expand-button expand-button-left" @onclick="ToggleLeftSidebar" style="left: @leftButtonLeft"></div>
    <div class="sidebar-right" style="width: @rightSidebarWidth">
        <!-- Right Sidebar Content -->
    </div>
    <div class="expand-button expand-button-right" @onclick="ToggleRightSidebar" style="right: @rightButtonRight"></div>
    <div class="toolbar">
        <span class="adarc-text">ADArC</span>
        <div class="center-toolbar">
            <button class="toolbar-button">
                <img src="save-icon.png" alt="Save Icon">
                <span>Save</span>
            </button>
            <button class="toolbar-button">
                <img src="help-icon.png" alt="Help Icon">
                <span>Help</span>
            </button>
            <button class="toolbar-button" @onclick="ToggleRunStop">
                <img src="@runStopIcon" alt="@runStopText">
                <span>@runStopText</span>
            </button>
        </div>
    </div>
</div>
<!--
	<div style="width:20%;height:100%;">
		<ComponentPane></ComponentPane>
	</div>
	-->
</body>


@code{
	bool isLeftExpanded = true;
	bool isRightExpanded = false;
	string leftSidebarWidth => isLeftExpanded ? "300px" : "0";
	string rightSidebarWidth => isRightExpanded ? "300px" : "0";
	string leftButtonLeft => isLeftExpanded ? "300px" : "20px";
	string rightButtonRight => isRightExpanded ? "300px" : "20px";
	string runStopIcon => isRunning ? "stop-icon.png" : "run-icon.png";
	string runStopText => isRunning ? "Stop" : "Run";
	bool isRunning = false;

	void ToggleLeftSidebar()
	{
		isLeftExpanded = !isLeftExpanded;
		isRightExpanded = false;
	}

	void ToggleRightSidebar()
	{
		isRightExpanded = !isRightExpanded;
		isLeftExpanded = false;
	}
	void ToggleRunStop()
	{
		isRunning = !isRunning;
	}

	public Index()
	{
		app = this;
	}

	public void StateChanged()
	{
		StateHasChanged();	
	}

	async Task triggerRender()
	{
		await JsRuntime.InvokeAsync<object>("triggerClick", refresh);
	}

	public static bool value;
	public static Index? app;

	public static ElementReference? refresh;

	[JSInvokable]
	public static async void updVal(bool nVal)
	{


		Index.value = nVal;
		await app.triggerRender();
	}

	protected async override Task OnAfterRenderAsync(bool firstRender)
	{
		if (firstRender)
		{
			var module = await JsRuntime.InvokeAsync<IJSObjectReference>("interopManager.getInteropManager");
			await module.InvokeVoidAsync("startCodeLoop", DotNetObjectReference.Create(this));

			
		}
	}

}